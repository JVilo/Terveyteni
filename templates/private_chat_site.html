{% extends "layout.html" %}
{% block content %}
<div class="container">
    <div class="row">
        <p class="h2">Lääkärikeskustelu</p>
        {% if lst|length == 0 and session.user_role== 2%}
        <div class="row">
        <div class="col-1">
            <form action="{{ url_for('post_doctor_private_chat', patient_id=patient_id) }}" method="post">
                <div>Otsikko: </div>
                <textarea name="title" rows="2" cols="20" minlength="3" maxlength="20" required oninvalid="this.setCustomValidity('otsikon pitää olla vähintään 3 merkkiä ja enintään 20 merkkiä pitkä.')"></textarea>
                <br>
                <div>Viesti: </div>
                <textarea name="content" rows="5" cols="40" minlength="3" maxlength="1000" required oninvalid="this.setCustomValidity('viestin pitää olla vähintään 3 merkkiä ja enintään 1000 merkkiä pitkä.')"></textarea>
                <br>
                <input type="submit" value="Lähetä">
                <input type="hidden" name="csrf_token" value="{{ session.csrf_token }}">
            </form>
        </div>
        {%endif%}
        </div>
        {%for content in lst%}
        {%if content.title%}
        <div class="row">
            <div class="col-1">
                <div class="h6">Otsikko: </div>
            </div>
            <div class="col">
                <div class="h6">{{ content.title }}</div>
            </div>
        </div>
        {%endif%}

        <div class="row">
            <div class="col-1">
                <div>Viesti: </div>
                <div>Lähetetty: </div>
                <div>Lähetäjä: </div>
            </div>
            <div class="col">
                <div>{{content.content}}</div>
                <div>{{content.sent_at.strftime("%Y-%m-%d %H:%M:%S") }}</div>
                <div>{{content.name}}</div>
                {% if content.user_id == session.user_id or session.user_role== 2 %}
                {%if not content.title%}
                <form action="{{ url_for('remove_piv', id=content.id, dr_id=content.doctor_id, patient_id=content.patient_id) }}" method="POST">
                    <button>
                        <input type="submit" value="Poista"/>
                    </button>
                </form>
                {%endif%}
                {%endif%}
                {% if content.user_id == session.user_id %}
                <a class="btn btn-secondary" data-bs-toggle="collapse" href="#edit-{{content.id}}">
                        Muokkaa?
                    </a>
                    <form id="edit-{{content.id}}" class="collapse row" action="{{ url_for('edit_mes_priv', id=content.id,dr_id=content.doctor_id, patient_id=content.patient_id) }}"
                          method="POST">
                        <div class="col">
                            <textarea name="content" rows="5" cols="40" minlength="3" maxlength="1000" required oninvalid="this.setCustomValidity('viestin pitää olla vähintään 3 merkkiä ja enintään 1000 merkkiä pitkä.')">{{content.content}}</textarea>
                        </div>
                        <div class="col-0.5">
                            <input type="submit" value="Lähetä"/>
                        </div>
                        <input type="hidden" name="csrf_token" value="{{ session.csrf_token }}">
                    </form>
                {%endif%}
            </div>
            <hr>
        </div>
        {% endfor %}

        {% if lst|length != 0 %}
        <form action="{{ form_url }}" method="POST">
            <textarea name="content" rows="5" cols="40" minlength="3" maxlength="1000" oninvalid="this.setCustomValidity('viestin pitää olla vähintään 3 merkkiä ja enintään 1000 merkkiä pitkä.')" required></textarea>
            <br>
            <input type="submit" value="Lähetä">
            <p></p>
            <input type="hidden" name="csrf_token" value="{{ session.csrf_token }}">
        </form>
            {%if session.user_role== 2%}
            <form action="{{url_for('end_priv_cha', id = lst[0][0])}}" method="POST">
                <input type="submit" value="Kuittaa valmiiksi">
            </form>
            {%endif%}
        {%endif%}

        <a href="http://127.0.0.1:5000/">Etusivulle</a>
        </div>
    </div>
{% endblock %}